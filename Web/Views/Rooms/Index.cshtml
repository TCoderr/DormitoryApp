@using Web.Models
@using Web.Models.ViewModels


@{
    ViewBag.Title = "Room List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3 class="display-5 pb-3 mb-3 border-bottom"> Room List </h3>


@{
    var user = Session["User"] as User;
}

@if (user.UserRole != Web.Models.User.Role.Student)
{
    <p class="text-end text-right">
        <a class="btn btn-success" href="@Url.Action("Create")"><i class="fas fa-plus"></i> Create New Room </a>
    </p>
}





<div class="row">
    <div class="col-3">
        <input type="text" id="txtSearch" class="form-control" placeholder="Search Keyword" />
    </div>

    <div class="col-3">

        <select class="form-control" id="selectStatus">
            <option value="">Select Room Status</option>
            <option value="@((int)RoomStatus.Available)">Available</option>
            <option value="@((int)RoomStatus.Unavailable)">Unavailable</option>
        </select>
    </div>
    <div class="col-2">
        <button id="btnSearch" class="btn btn-dark"> Search</button>
    </div>
</div>


<table class="table table-striped table-bordered table-advance table-hover responsive nowrap order-column  mt-4" id="roomDataTable" width="100%">
   
    
    <thead>
        <tr>
            <th>
            </th>
            <th>
                Room Name
            </th>
            <th>
                Room Fee
            </th>
            <th>
                Room Capacity
            </th>
            <th>
                Current Capacity
            </th>
            <th>
                Status
            </th>
            <th>
                Operations
            </th>
        </tr>
    </thead>
</table>




@section scripts{


    <script>

        var dataGrid;


            $(document).ready(function () {
            searchButton = Ladda.create(document.querySelector("#btnSearch"));
                dataGrid = document.DormitoryApp.dataTable({
                 id: "roomDataTable",
                url: '@Url.Action("GetRoomList")',
                sortIndex: 0,
                sortDirection: "desc",
                searchButton: searchButton,
                columns: [
                    { data: "Id", name: "Id" },
                    { data: "RoomName", name: "RoomName", autoWidth: true },
                    { data: "RoomFee", name: "RoomFee", autoWidth: true },
                    { data: "RoomCapacity", name: "RoomCapacity", autoWidth: true },
                    { data: "CurrentCapacity", name: "CurrentCapacity", autoWidth: true },
                    { data: "Status", name: "Status", autoWidth: true },

                        {
                            mRender: function (data, type, row) {

                                var html = "";

                                if ('@user.UserRole' != '@Web.Models.User.Role.Student') {
                                   var editBtn =  $("<a/>", {
                                        "class": "btn btn-primary btn-sm text-white",
                                        "href": "Rooms/Edit?id=" + row.Id ,
                                        style: "cursor:pointer;",
                                        text: ' Edit'
                                   });

                                    editBtn.prepend(document.EditIcon);
                                    html = editBtn[0].outerHTML;


                                    var detailsBtn = $("<a/>", {
                                        "class": "btn btn-warning btn-sm text-white",
                                        "href": "Rooms/Details?id=" + row.Id,
                                        style: "cursor:pointer;",
                                        text: ' Details'
                                    });

                                    detailsBtn.prepend(document.DetailsIcon);
                                    html += " " + detailsBtn[0].outerHTML;


                                    var deleteBtn = $("<a/>", {
                                        "class": "btn btn-danger btn-sm text-white",
                                        onclick : "DeleteRoom(" + row.Id + ");",
                                        style: "cursor:pointer;",
                                        text: ' Delete'
                                    });

                                    deleteBtn.prepend(document.DeleteIcon);
                                    html += " " + deleteBtn[0].outerHTML;
                                }

                                if ('@user.UserRole' == '@Web.Models.User.Role.Student') {

                                    var applyBtn = $("<a/>", {
                                        "class": "btn btn-danger btn-sm text-white",
                                        onclick: "ApplyRoom(" + row.Id + ");",
                                        style: "cursor:pointer;",
                                        text: ' Apply'
                                    });

                                    applyBtn.prepend(document.DeleteIcon);
                                    html += " " + applyBtn[0].outerHTML;
                                }


                                return html;
                            }
                        }
                ],
                columnDefs: [
                 {
                     "targets": 0,
                     "visible": false,
                     "searchable": false
                 },
                 {
                     "targets": 6,
                     "searchable": false,
                     "orderable": false
                 }
                ]
            });
            $("#btnSearch").click(function () {
                searchButton.start();
                var searchModel = {
                    SearchText: $("#txtSearch").val(),
                    StatusId: $("#selectStatus").val(),
                };
                dataGrid.search(JSON.stringify(searchModel));
                dataGrid.draw();
            });

        });




        function DeleteRoom(id) {
               var obj = {
                url: '@Url.Action("DeleteRoom")',
                data: { id: id },
                grid: dataGrid
            };
            document.DormitoryApp.deleteOperation(obj);
        }





    </script>



}
